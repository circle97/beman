# 沟通沙盒功能说明文档

## 功能概述

沟通沙盒是Beman情感关系管理平台的核心功能模块之一，旨在帮助用户提升沟通技巧、解决关系冲突、改善情感表达。通过场景模拟、智能建议、技巧训练等方式，为用户提供全方位的沟通指导。

## 核心功能

### 1. 沟通场景模拟 🎭

#### 场景类别
- **关系冲突场景** - 处理日常关系中的冲突和分歧
  - 家务分工分歧
  - 消费观念差异
  - 时间安排冲突
- **情感支持场景** - 在对方情绪低落时提供支持和安慰
  - 工作压力安慰
  - 家庭矛盾处理
- **沟通改善场景** - 改善日常沟通方式和效果
  - 表达需求练习
  - 倾听技巧训练

#### 难度分级
- **Easy** - 适合初学者的基础场景
- **Medium** - 中等复杂度的常见情况
- **Hard** - 高难度的复杂冲突

### 2. 对话建议生成 💬

#### 智能分析
- **情感分析** - 识别用户输入的情感状态（正面/负面/中性）
- **沟通风格分析** - 分析表达方式（自信/被动/攻击性）
- **关键词提取** - 基于jieba分词的关键信息识别

#### 个性化建议
- **即时回应建议** - 针对当前情况的快速应对策略
- **沟通风格改善** - 提升表达效果的具体方法
- **冲突解决策略** - 化解分歧的步骤指导
- **长期关系策略** - 维护健康关系的持续建议

### 3. 冲突解决指导 🔧

#### 升级模式识别
- 指责性语言
- 人身攻击
- 翻旧账
- 情绪化表达
- 回避问题

#### 解决策略指导
- 冷静分析
- 换位思考
- 寻找共同点
- 妥协让步
- 寻求第三方帮助

#### 预防措施建议
- 定期沟通
- 情绪管理
- 边界设定
- 共同目标
- 感恩练习

### 4. 沟通技巧训练 🛠️

#### 积极倾听技巧
- 保持眼神接触
- 不打断对方
- 重复关键信息
- 表达理解和同情
- 提问澄清

#### 非暴力沟通
- 观察事实
- 表达感受
- 说明需求
- 提出请求

#### 冲突解决技巧
- 保持冷静
- 寻找共同点
- 避免指责
- 寻求解决方案
- 达成共识

#### 情感表达技巧
- 使用"我"语句
- 具体描述感受
- 避免绝对化语言
- 表达期望而非要求

### 5. 对话模板生成 📝

#### 模板类型
- **开场白** - 如何开始敏感话题的对话
- **感受表达** - 如何清晰表达自己的情感
- **理解问题** - 如何确认和澄清对方的意思
- **解决建议** - 如何提出建设性的解决方案

#### 使用技巧
- 根据具体情况调整语言
- 保持真诚和开放的态度
- 给对方足够的回应时间
- 注意非语言沟通

## API接口

### 基础信息
- **服务路径**: `/api/sandbox`
- **服务名称**: CommunicationSandboxService
- **版本**: 1.0.0

### 接口列表

#### 1. 获取沟通场景
```
GET /api/sandbox/scenarios
```
**参数**:
- `category` (可选): 场景类别
- `difficulty` (可选): 难度级别

**响应**: 场景列表，包含类别、描述、场景详情

#### 2. 生成对话建议
```
POST /api/sandbox/dialogue-suggestions
```
**请求体**:
```json
{
  "scenario_id": "rc_001",
  "user_input": "我觉得家务分配不公平"
}
```

**响应**: 场景信息、用户输入分析、具体建议、下一步行动

#### 3. 练习沟通技巧
```
POST /api/sandbox/practice-skill
```
**请求体**:
```json
{
  "skill_type": "active_listening"
}
```

**响应**: 技巧类型、具体建议、练习方法、每日目标、进度跟踪

#### 4. 获取冲突解决指导
```
POST /api/sandbox/conflict-guide
```
**请求体**:
```json
{
  "conflict_type": "escalation"
}
```

**响应**: 警告信号、立即行动、预防建议、解决流程、沟通工具

#### 5. 生成对话模板
```
POST /api/sandbox/dialogue-template
```
**请求体**:
```json
{
  "situation": "关系冲突",
  "emotion": "生气"
}
```

**响应**: 情况描述、情感状态、模板内容、使用技巧

#### 6. 获取可用技巧
```
GET /api/sandbox/skills
```
**响应**: 技巧类型列表

#### 7. 获取场景类别
```
GET /api/sandbox/categories
```
**响应**: 场景类别列表

#### 8. 健康检查
```
GET /api/sandbox/health
```
**响应**: 服务状态、组件信息、时间戳

#### 9. 服务信息
```
GET /api/sandbox/info
```
**响应**: 服务描述、功能特性、接口列表

## 技术实现

### 架构设计
- **服务层**: CommunicationSandboxService - 核心业务逻辑
- **路由层**: FastAPI路由 - RESTful API接口
- **数据层**: 内置场景库和模板库
- **算法层**: 基于关键词的情感分析和风格识别

### 核心算法
- **中文分词**: 使用jieba进行中文文本分析
- **情感识别**: 基于关键词的情感状态判断
- **风格分析**: 沟通模式识别和分类
- **建议生成**: 多维度智能建议算法

### 数据结构
- **场景库**: 分类组织的沟通场景数据
- **模式库**: 冲突升级和解决模式
- **技巧库**: 分类的沟通技巧集合
- **模板库**: 对话模板和表达方式

## 使用示例

### 1. 获取家务分工场景
```python
# 获取关系冲突类别的中等难度场景
scenarios = service.get_scenario("relationship_conflict", "medium")
```

### 2. 生成对话建议
```python
# 针对家务分工场景生成建议
suggestions = service.generate_dialogue_suggestions(
    "rc_001", 
    "我觉得家务分配不公平，总是我在做"
)
```

### 3. 练习倾听技巧
```python
# 获取积极倾听技巧的练习内容
practice = service.practice_communication_skill("active_listening")
```

### 4. 获取冲突解决指导
```python
# 获取冲突升级的预防建议
guide = service.get_conflict_resolution_guide("escalation")
```

## 测试验证

### 单元测试
- 完整的测试用例覆盖所有核心功能
- 测试文件: `tests/test_communication_sandbox.py`
- 测试覆盖: 服务初始化、场景管理、建议生成、技巧练习等

### 功能测试
- 测试脚本: `test_sandbox.py`
- 验证内容: 服务启动、功能调用、数据返回、错误处理

### 测试命令
```bash
# 运行单元测试
pytest tests/test_communication_sandbox.py -v

# 运行功能测试
python test_sandbox.py
```

## 部署说明

### 环境要求
- Python 3.9+
- FastAPI 0.104.1+
- jieba 0.42.1+

### 启动服务
```bash
# 开发模式
uvicorn src.main:app --reload --host 0.0.0.0 --port 8000

# 生产模式
uvicorn src.main:app --host 0.0.0.0 --port 8000
```

### 服务访问
- **API文档**: http://localhost:8000/docs
- **ReDoc文档**: http://localhost:8000/redoc
- **健康检查**: http://localhost:8000/api/sandbox/health

## 扩展计划

### 短期优化
- 增加更多沟通场景和模板
- 优化建议生成算法
- 添加用户反馈机制

### 长期发展
- 集成机器学习模型
- 支持多语言场景
- 添加语音交互功能
- 建立个性化学习路径

## 技术支持

### 问题反馈
- 功能问题: 通过测试脚本验证
- 性能问题: 检查健康检查接口
- 集成问题: 查看API文档和示例

### 开发指南
- 遵循现有代码结构
- 添加相应的测试用例
- 更新API文档
- 维护开发日志

---

*文档版本: 1.0.0*  
*最后更新: 2024年12月26日*  
*维护者: Beman开发团队*
